<tal:block tal:define="macro python:here.macros('/app/macroform.env'); 
                             req here/request;
                             id_site req/id_site;
                             id_treeapp python:req.get('id_treeapp', '');
                             id_aplicativo req/id_aplicativo;
                             schema req/schema;
                             meta_type req/meta_type;
                             portal here/portal;
                             util here/util;
                             file here/file;
                             instance python:here.app(schema=schema);
                             datahoje python:util.dtnow('%d/%m/%Y %H:%M');
                             dados python:portal._getDadosTreeApp(env_site=id_site, id_treeapp=id_treeapp);
                             configuracao dados/configuracao;
                             publicacao dados/publicacao;
                             exportar_json python:publicacao.get('exportar_json', '');
                             exportar_xml python:publicacao.get('exportar_xml', '');
                             instance python:here.app(schema=schema);
                             lastdate python:instance._getDateTimeHash(id_treeapp=id_treeapp, id_aplicativo=id_aplicativo);
                             ">
<metal_macro metal:use-macro="macro/macros/form">

<slot_script metal:fill-slot="javascripts">
    <link type="text/css" href="/extensao/css/ui.all.css" rel="Stylesheet" />
    <script type="text/javascript" src="/extensao/js/ui.dialog.js"></script>
    <style type="text/css">
    .ui-dialog { position: relative; padding: .2em; width: 300px;}
    .ui-dialog-titlebar { padding: .5em .3em .3em 1em; position: relative; height:20px;}
    .ui-dialog-title { float: left; margin: .1em 0 .2em; font-size:18px}
    .ui-dialog-titlebar-close { position: absolute; right: .3em; top: 50%; width: 19px; margin: -10px 0 0 0; padding: 1px; height: 18px; }
    .ui-dialog-titlebar-close span { display: block; margin: 1px; }
    .ui-dialog-titlebar-close:hover, .ui-dialog-titlebar-close:focus { padding: 0; }
    .ui-dialog-content { padding: .5em 1em; background: none; overflow: auto; clear:both;}
    .ui-dialog-buttonpane { text-align: left; border-width: 1px 0 0 0; background-image: none; margin: .5em 0 0 0; padding: .3em 1em .5em .4em; }
    .ui-dialog-buttonpane button { float: right; margin: .5em .4em .5em 0; cursor: pointer; padding: .2em .6em .3em .6em; line-height: 1.4em; width:auto; overflow:visible; }
    .field_veja {
        width:100%;
        border: 1px solid #9FC6D9;
        background-image:url(/imgs/fdo_form.png);
        background-repeat:repeat-x;
        background-position:25% 0;
    }
    </style>
    <script type="text/javascript" src="/extensao/js/environ_relacionamento.js"></script>
    <script type="text/javascript" src="/extensao/js/environ_destaque.js"></script>
    <script type="text/javascript" src="/extensao/js/tiny_mce/tiny_mce.js"></script>
    <script type="text/javascript" tal:content="structure python:util.py2js(ID_SITE=id_site,
                                                                            SCHEMA=schema,
                                                                            BASEMETHOD=portal._getUrlAppMethod(meta_type=instance.meta_type, schema=schema, id_site=id_site),
                                                                            ID_TREEAPP=id_treeapp,
                                                                            DATAHOJE=datahoje,
                                                                            ID_APLICATIVO=id_aplicativo,
                                                                            EXPORTAR_JSON=exportar_json,
                                                                            EXPORTAR_XML=exportar_xml)"></script>
    <script type="text/javascript" tal:content="structure python:util.py2js(TITULO_DESTAQUE=configuracao.get('titulo_destaque', None),
                                                                            DESCRICAO_DESTAQUE=configuracao.get('descricao_destaque', None),
                                                                            IMAGEM_DESTAQUE=configuracao.get('imagem_destaque', None),
                                                                            TAGS=configuracao.get('tags_verify', 'livre'))"></script>
    <script type="text/javascript">
    var IFRAMEUSE = false;
    var abas = ['geral', 'fotos', 'fotosipad', 'videosipad', 'tags', 'relacionamento'];
    var msgs = ['Aguarde um momento at&eacute; que o sistema acabe de fazer o upload.'];

    $(document).ready(function()
    {
      $('#tipo_corpo_E').click();
      var form = document.forms['conteudo'];
      validateElement(form.publicado_em);
      validateElement(form.expira_em);
      validateElement(form.data_edicao);
      validateElement(form.ordem);

      $("#box_autor").dialog({autoOpen:false, height:150, modal: true, overlay: {backgroundColor:'#000', opacity:0.5},
                             buttons: {'Editar': function() {
                                 id_autor = $('#autor_titulo').attr('id_autor');
                                 var titulo = $('#autor_titulo').attr('value');
                                 var email = $('#autor_email').attr('value');
                                 var grupo = $('#autor_grupo').attr('value');
                                 if (!id_autor)
                                 {
                                     alert('Nenhum autor selecionado');
                                     return;
                                 }
                                 if (!titulo)
                                 {
                                     alert('Digite o autor');
                                     return;
                                 }
                                 if (!email)
                                 {
                                     alert('Digite o e-mail');
                                     return;
                                 }

                                 $('#box_autor_wait').show();
                                 $.post(BASEMETHOD + 'editAutor', {id_autor:id_autor, nome:titulo, email:email, grupo:grupo},
                                 function(data) {
                                   $('#box_autor_wait').hide();
                                   $("#box_autor").dialog('close');
                                 });
                             },
                             'Adicionar': function() {
                                 id_autor = undefined;
                                 var titulo = $('#autor_titulo').attr('value');
                                 var email = $('#autor_email').attr('value');
                                 var grupo = $('#autor_grupo').attr('value');
                                 if (!titulo)
                                 {
                                     alert('Digite o autor');
                                     return;
                                 }
                                 if (!email)
                                 {
                                     alert('Digite o e-mail');
                                     return;
                                 }
                                 $('#box_autor_wait').show();
                                 $.post(BASEMETHOD + 'addAutor', {nome:titulo, email:email, grupo:grupo},
                                 function(data) {
                                   $('#box_autor_wait').hide();
                                   $("#box_autor").dialog('close')
                                 });
                             },
                             'Deletar': function() {
                                 id_autor = undefined;
                                 autor = $('#autor_titulo').attr('id_autor');
                                 if (!autor)
                                 {
                                     alert('Nenhum item selecionado');
                                     return;
                                 }
                                 $('#box_autor_wait').show();
                                 $.post(BASEMETHOD + 'delAutor', {'id_autores:list':autor},
                                 function(data) {
                                   id_pais = undefined;
                                   $('#box_autor_wait').hide();
                                   $("#box_autor").dialog('close');
                                 });
                             }, },
                             title:'Editar Autor',
                             close: function(){
                                 $('#autor_titulo').removeAttr('id_autor').attr('value', '');
                                 $('#autor_email').removeAttr('id_autor').attr('value', '');
                                 $('#autor_grupo').removeAttr('id_autor').attr('value', '');
                                 popautor();
                             }});


    });
    var id_sel_autor;
    var id_autor;
    function addNewAutor(el)
    {
        id_sel_autor = el;
        var box = $('#autor_titulo');
        var email = $('#autor_email');
        var grupo = $('#autor_grupo');
        var el = document.getElementById(el);
        el = $(el.options[el.selectedIndex]);
        if (el.attr('value'))
        {
            box.attr('value', el.text()).attr('id_autor', el.attr('value'));
            email.attr('value', el.attr('email') );
            grupo.attr('value', el.attr('grupo') );
        }
        $("#box_autor").dialog('open');
    }
    function popautor()
    {
        var autor1 = $('#autor1');
        var autor2 = $('#autor2');
        autor1.empty().append( $('<'+'option selected="'+ (!id_autor ? 'selected':'') +'" value=""'+'>Selecione<'+'/option'+'>') );
        autor2.empty().append( $('<'+'option selected="'+ (!id_autor ? 'selected':'') +'" value=""'+'>Selecione<'+'/option'+'>') );
        seli = -1;
        $.getJSON(BASEMETHOD + 'getAutores', {}, function(json){
           for (i=0; i<json.length; i++)
           {
             if (parseInt(id_autor) == parseInt(json[i]['id_autor']))
                 seli = i;
             autor1.append( $('<'+'option value="'+json[i]['id_autor']+'" nome="'+ json[i]['nome'] +'" email="' + json[i]['email'] + '" grupo="' + json[i]['grupo'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
             autor2.append( $('<'+'option value="'+json[i]['id_autor']+'" nome="'+ json[i]['nome'] +'" email="' + json[i]['email'] + '" grupo="' + json[i]['grupo'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
           }

           $('#box_autores > div > select').each(function(j, item){

               if (j >= 2)
               {
                   $(item).empty().append( $('<'+'option selected="selected" value=""'+'>Selecione<'+'/option'+'>') );
                   for (i=0; i<json.length; i++)
                   {
                       $(item).append( $('<'+'option value="'+json[i]['id_autor']+'" nome="'+ json[i]['nome'] +'" email="' + json[i]['email'] + '" grupo="' + json[i]['grupo'] +'" >'+json[i]['nome']+'<'+'/option'+'>') );
                   } 
               }

           });

           document.getElementById('autor1').selectedIndex = seli+1;
           document.getElementById('autor2').selectedIndex = seli+1;
           id_autor = undefined;
        });
    }
    function addNewComboAutor()
    {
      var n = $('#box_autores > div').length;
      var box = $('<div class="formu"><label for="autor2">Autor ' + (n + 1)  + ':</label></div>');
      $('#box_autores > div:last > select').clone().appendTo(box);
      $('<a href="javascript:void(0)" onclick="delComboAutor(this)"><img src="/imgs/minu.gif" /></a>').appendTo(box);
      box.appendTo('#box_autores');
    }
    function delComboAutor(n)
    {
      $(n.parentNode).remove()
    }

    tinyMCE.init({
        mode : "specific_textareas",
        theme : "advanced",
        plugins : "advlink",
        language : "pt",
        theme_advanced_buttons1_add_before : "bold,italic,underline,strikethrough,separator,justifyleft,justifycenter,justifyright,justifyfull,separator,forecolor,separator,bullist,numlist,separator,link,unlink",
        theme_advanced_disable : "backcolor,link,unlink,undo,redo,bullist,numlist,separator,justifyleft,justifycenter,justifyright,justifyfull,bold,italic,underline,strikethrough,outdent,indent,image,cleanup,help,code,hr,removeformat,formatselect,fontselect,fontsizeselect,styleselect,sub,sup,charmap,visualaid,anchor",
        theme_advanced_toolbar_location : "top",
        theme_advanced_toolbar_align : "left",
        theme_advanced_statusbar_location : "bottom",
        content_css : "example_word.css",
        file_browser_callback : "fileBrowserCallBack",
        cleanup_on_startup : true,
        force_br_newlines : true,
        convert_newlines_to_brs : true,
        paste_use_dialog : false,
        theme_advanced_resizing : false,
        theme_advanced_resize_horizontal : false,
        theme_advanced_link_targets : "_something=My somthing;_something2=My somthing2;_something3=My somthing3;",
        paste_auto_cleanup_on_paste : true,
        paste_convert_headers_to_strong : false,
        paste_strip_class_attributes : "all",
        paste_remove_spans : false,
        paste_remove_styles : true
    })
    function resetNoticia()
    {
        var form = document.forms['conteudo'];
        var dt = new Date();
        var year = dt.getFullYear();
        var month = dt.getMonth() + 1;
        if (month < 10) month = '0' + month;
        var day = dt.getDate();
        if (day < 10) day = '0' + day;
        var hora = dt.getHours();
        if (hora < 10) hora = '0' + hora;
        var minute = dt.getMinutes();
        if (minute < 10) minute = '0' + minute;
        var oldvalue = form.publicado_em.value;

        form.reset();
        with (form)
        {
            tipo_corpo[0].checked = true;
            tipo_corpo[0].onclick();
            editor_normal.value = '';
            document.getElementById('count_titulo').innerHTML = '0';
            document.getElementById('count_resumo').innerHTML = '0';
        }
        clearArquivos();
        $('#div_aba_fotos span').each(
          function(n, item)
          {
              if (n > 0) $(this).remove();
          }
        )
        editComboImg();
        relacionamento.clean();
        mudarAba('geral');
        form.publicado_em.value = oldvalue;
        //form.publicado_em.value = day + '/' + month + '/' + year + ' ' + hora + ':' + minute;
    }
    function validaForm(exportar)
    {
        var form = document.forms['conteudo'];
        var errs = [];
        with (form)
        {
            if (tipo.options[tipo.selectedIndex].value == '8')
            {
                if (tags.value.search('celular') < 0)
                    tags.value = tags.value + '\ncelular';
            }

            if (isEmpty(titulo.value))
                errs.push('O campo t&iacute;tulo &eacute; obrigat&oacute;rio.');
            if (isEmpty(pdf.value))
                errs.push('O campo nome do PDF &eacute; obrigat&oacute;rio.');
            if (capa.checked && isEmpty(titulo_capa.value))
                errs.push('O campo T&iacute;tulo na capa &eacute; obrigat&oacute;rio.');
            if (isEmpty(ordem.value))
                errs.push('O campo ordem &eacute; obrigat&oacute;rio.');
            if (!isEmpty(imagem1.value) || !isEmpty(imagemipad1.value) && isEmpty(titulo_galeria.value))
              //  errs.push('O campo tÃ­tulo da galeria &eacute; obrigat&oacute;rio.');
            if (isEmpty(titulo.value))
                errs.push('O campo t&iacute;tulo &eacute; obrigat&oacute;rio.');
            if (tipo.selectedIndex <= 0)
                errs.push('O campo tipo &eacute; obrigat&oacute;rio.');
            if ((document.getElementById('tipo_corpo_N').checked) && (isEmpty(editor_normal.value)))
                errs.push('O campo corpo &eacute; obrigat&oacute;rio.');
            if (isEmpty(publicado_em.value))
                errs.push('O campo publicado em &eacute; obrigat&oacute;rio.');
            if (TITULO_DESTAQUE && isEmpty(titulo_destaque.value))
                errs.push('O campo T&iacute;tulo destaque &eacute; obrigat&oacute;rio.');
            if (DESCRICAO_DESTAQUE && isEmpty(descricao_destaque.value))
                errs.push('O campo Descri&ccedil;&atilde;o destaque &eacute; obrigat&oacute;rio.');
            if (IMAGEM_DESTAQUE && isEmpty(imagem_destaque.value))
                errs.push('O campo Imagem destaque &eacute; obrigat&oacute;rio.');
            if (TAGS == 'obrigatorio' && isEmpty(tags.value))
                errs.push('O campo Tags &eacute; obrigat&oacute;rio.');
            if ($("#pdf").val().match("[\/*+\u007e-\u00FF]") || !$("#pdf").val().match("[0-9]")) {
                errs.push('O campo PDF deve possuir caracteres v&aacute;lidos e um numeral.');}
            if (TAGS == 'alerta' && isEmpty(tags.value))
            {
                if (! confirm(unescape('Sistema de alerta:\nEste conte%FAdo est%E1 sem tags, deseja continuar mesmo assim?')))
                    return;
            }

            envpermissao.erros(errs);

            if (errs.length > 0)
            {
                showError(errs);

            } else {
                aguarde(false);
                var dados = {};

                if (exportar)
                    dados['exportar'] = 1;
                dados['exportar_json'] = EXPORTAR_JSON;
                dados['exportar_xml'] = EXPORTAR_XML;

                dados['id_site'] = ID_SITE;
                dados['id_treeapp'] = ID_TREEAPP;
                dados['id_aplicativo'] = ID_APLICATIVO;
                dados['titulo_categoria'] = titulo_categoria.value.replace('+', '%2b', 'g');
                dados['titulo'] = titulo.value.replace('+', '%2b', 'g');
                dados['descricao'] = descricao.value.replace('+', '%2b', 'g');
                if (document.getElementById('tipo_corpo_E').checked == true)
                    dados['editor'] = 1;
                dados['tipo'] = tipo.options[tipo.selectedIndex].value;

                if (autor.value)
                    dados['autor'] = autor.value.replace('+', '%2b', 'g');;

                if (document.getElementById('tipo_corpo_N').checked == true)
                    dados['corpo'] = editor_normal.value.replace('+', '%2b', 'g');
                else {
                    dados['corpo'] = tinyMCE.getContent('editor_full').replace('+', '%2b', 'g');
                }

                if (has_video.checked == true) dados['video'] = 1;
                if (has_audio.checked == true) dados['audio'] = 1;
                if (has_galeria.checked == true) dados['galeria'] = 1;

                dados['ordem'] = (ordem.value == '')? "100": ordem.value;
                dados['pdf'] = (pdf.value == '')? "null": pdf.value;
                dados['is_capa'] = capa.checked;
                dados['titulo_capa'] = (titulo_capa.value == '')? "null": titulo_capa.value.replace('+', '%2b', 'g');
                dados['titulo_galeria'] = (titulo_galeria.value == '')? "null": titulo_galeria.value.replace('+', '%2b', 'g');

                dados['publicado_em'] = publicado_em.value;
                dados['expira_em'] = expira_em.value;
                dados['data_edicao'] = data_edicao.value;
                if (publicado[0].checked == true)
                    dados['publicado'] = 1;

                // Fotos
                var fid = [];
                var ffg = [];
                var fc = [];
                var fl = [];
                var fli = [];
                var fal = []; 
                $('#div_aba_fotos span').clone().each(
                 function(n)
                 {
                     var ni = n+1;
                     var form = document.forms['conteudo'];
                     var imagem = form['imagem' + ni];
                     var imagemgrande = form['imagemgrande' + ni];
                     var credito = form['credito' + ni];
                     var align = form['alinhamento' + ni];
                     var legenda = form['legenda' + ni];
                     var link = form['linkfoto' + ni];

                     fid.push(imagem.value);
                     ffg.push(imagemgrande.value);
                     fc.push(credito.value.replace('+', '%2b', 'g'));
                     fl.push(legenda.value.replace('+', '%2b', 'g'));
                     fli.push( $(link).attr('jtext') );

                     for (var num=0; num<align.length; num++)
                     {
                         if (align[num].checked == true)
                             fal.push( align[num].value );
                     }
                 }
                );
                dados['foto_id:list'] = fid;
                dados['foto_grande_id:list'] = ffg;
                dados['foto_credito:list'] = fc;
                dados['foto_legenda:list'] = fl;
                dados['foto_link:list'] = fli;
                dados['foto_alinhamento:list'] = fal;

                // Videos
                var vid = [];
                $('#div_aba_videos span').clone().each(function(n){
                     var ni = n+1;
                     var form = document.forms['conteudo'];
                     var embed = form['embed' + ni].value;
                     vid.push( embed );
                });
                dados['videos:list'] = vid;
                
                //fotos iPad
                var fid = [];
                var fc = [];
                var fl = [];
                $('#div_aba_fotosipad span').clone().each(
                     function(n)
                     {
                         var ni = n+1;
                         var form = document.forms['conteudo'];
                         var imagem = form['imagemipad' + ni];
                         var credito = form['creditoipad' + ni];
                         var legenda = form['legendaipad' + ni];

                         fid.push(imagem.value);
                         fc.push(credito.value.replace('+', '%2b', 'g'));
                         fl.push(legenda.value.replace('+', '%2b', 'g'));
                     }
                );
                dados['foto_ipad_id:list'] = fid;
                dados['foto_ipad_credito:list'] = fc;
                dados['foto_ipad_legenda:list'] = fl;
                
                //videos iPad
                var nomes = [];
                var aud = [];
                var links = [];
                var thumbs = [];
                $('#div_aba_videosipad span').clone().each(function(n){
                     var ni = n+1;
                     var form = document.forms['conteudo'];
                     var nome = form['nomeipad' + ni].value;
                     var audio = form['audioipad' + ni].checked;
                     var link = form['linkvidipad' + ni].value;
                     var thumbnail = form['thumbnailipad' + ni].value;
                     
                     nomes.push(nome.replace('+', '%2b', 'g'));
                     aud.push(audio);
                     links.push(link);
                     thumbs.push(thumbnail);
                });
                dados['videos_ipad_nome:list'] = nomes;
                dados['videos_ipad_audio:list'] = aud;
                dados['videos_ipad_link:list'] = links;
                dados['videos_ipad_thumbnail:list'] = thumbs;
                
                //destaque
                destaque.add(dados);

                //tags
                dados['tags'] = tags.value;

                //relacionamento
                relacionamento.addRelacionamento(dados);

                //permissoes
                envpermissao.add(dados);

                $.ajax({
                  type: "POST",
                  url: BASEMETHOD + "addNoticia",
                  data: dados,
                  beforeSend: function(x) {
                    if(x && x.overrideMimeType) {
                      x.overrideMimeType("application/j-son;charset=UTF-8");
                    }
                  },
                  dataType: "json",
                  success: function(res){
                     if (res['ok'])
                     {
                       showOk(res['ok']);
                       abrirF5Listagem('/app/listarcontent.env?edicao=1&id_site=' + ID_SITE + '&id_treeapp=' + ID_TREEAPP);
                       resetNoticia();
                     } else {
                       showError([res['error']]);
                     }
                     aguarde(true);
                  },
                  error: function(XMLHttpRequest, textStatus, errorThrown) { 
                  }
                });
            }
        }
    }
    function aguarde(w)
    {
        var bts = document.getElementById('bt_salvar')
        var btp= document.getElementById('bt_salvarp')
        if (w)
        {
           bts.value = 'Salvar';
           bts.disabled = false;
           bts.onclick = function(){validaForm(false)};
           if (btp)
           {
             btp.value = 'Salvar/Publicar';
             btp.disabled = false;
             btp.onclick = function(){validaForm(true)};
           }
        } else {
           bts.value = 'Aguarde...';
           bts.disabled = true;
           bts.onclick = function(){alert('Aguarde, processo em andamento...')};
           if (btp)
           {
             btp.value = 'Aguarde...';
             btp.disabled = true;
             btp.onclick = function(){alert('Aguarde, processo em andamento...')};
           }
        }
    }
    function selectTipoCorpo()
    {
        var tN = document.getElementById('tipo_corpo_N');
        var tE = document.getElementById('tipo_corpo_E');
        var tipoCorpo = '';
        if (tN.checked)
            tipoCorpo = 'normal';
        else if (tE.checked)
            tipoCorpo = 'editor';
        return tipoCorpo;
    }
    function insertPicsBody(obj)
    {
        var tipoCorpo = selectTipoCorpo();
        var opt = obj.getElementsByTagName('option');
        var objTextArea = document.getElementById('editor_normal');
        var objTextAreaEditor = document.getElementById('editor_full');
        if (obj.selectedIndex == 0)
        {
            return;
        } else {
            for (var i=0; i<opt.length; i++)
            {
                if (opt[i].selected)
                {
                    var strTexto = opt[i].value;
                    if (tipoCorpo == 'normal')
                    {
                        inserindoFotoTextoNormal(objTextArea, strTexto);
                    } else {
                        inserindoFotoTextoEditor(objTextAreaEditor, strTexto);
                    }
                }
            }
        }
        obj.selectedIndex = 0;
    }
    function inserindoFotoTextoNormal(objTextArea, strTexto)
    {
        if (navigator.appName.indexOf("Netscape")!=-1)
        {
            strValor = objTextArea.value;
            objTextArea.value = strValor.substr(0, objTextArea.selectionStart) + strTexto + strValor.substr(objTextArea.selectionStart, strValor.length);
        } else {
            objTextArea.focus();
            var objRange = document.selection.createRange();
            objRange.text = strTexto;
        }
        objTextArea.focus();
        return 1;
    }
    function execCommand(command, user_interface, value)
    {
      var inst = tinyMCE.selectedInstance;
      inst.execCommand(command, user_interface, value);
    }
    function insertAction(valor)
    {
        var inst = tinyMCE.getInstanceById('editor_full');
        var elm = inst.getFocusElement();
        elm = tinyMCE.getParentElement(elm, "a");
        execCommand("mceBeginUndoLevel");

        if (elm == null)
        {
          var ea = $('<' + 'a>' + inst.selection.getSelectedHTML() + '<' + '/a>');
          ea.attr('href', '#h2href:' + valor)
          execCommand("mceInsertContent", false, $('<' + 'span>' + '<' + '/span>').append(ea).html());

          var elementArray = tinyMCE.getElementsByAttributeValue(inst.getBody(), "a", "href", "#mce_temp_url#");
          for (var i=0; i<elementArray.length; i++)
          {
            var elm = elementArray[i];
            if (tinyMCE.isGecko)
            {
              var sp = inst.getDoc().createTextNode(" ");
              if (elm.nextSibling)
                elm.parentNode.insertBefore(sp, elm.nextSibling);
              else
                elm.parentNode.appendChild(sp);

              var rng = inst.getDoc().createRange();
              rng.setStartAfter(elm);
              rng.setEndAfter(elm);

              var sel = inst.getSel();
              sel.removeAllRanges();
              sel.addRange(rng);
            }
            setAllAttribs(elm);
          }
        }
    }
    function inserindoFotoTextoEditor(objTextAreaEditor, strTexto)
    {
        try {
            var inst = tinyMCE.getInstanceById(tinyMCE.getWindowArg('editor_id'));
            execCommand("mceInsertContent", false, strTexto);
        } catch(e) {}
        return 1;
    }
    /** EDIT **/
    function showNormalEditor()
    {
        var normaleditor = document.getElementById('normaleditor');
        var fulleditor = document.getElementById('fulleditor');

        fulleditor.style.display = 'none';
        normaleditor.style.display = 'block';

        document.getElementById('editor_normal').value = tinyMCE.getContent('editor_full').replace('&amp;', '&', 'g');
        document.getElementById('editor_normal').value = tinyMCE.getContent('editor_full').replace('<br /' + '>', '\n', 'g');

    }
    function showFullEditor()
    {
        var normaleditor = document.getElementById('normaleditor');
        var fulleditor = document.getElementById('fulleditor');

        fulleditor.style.display = 'block';
        normaleditor.style.display = 'none';

        var editorFull = document.getElementById('editor_full');
        var editorNorm = document.getElementById('editor_normal');

        editorFull.value = editorNorm.value.replace('\n', '<br' + '/' + '>', 'g');
        tinyMCE.updateContent('editor_full');
    }

    function editComboImg()
    {
        $('#inserirFotosCorpo').empty();
        var opt = new Option('Marcadores', '');
        $('#inserirFotosCorpo').append(opt);

        var opt = new Option('Veja Mais', '[SAIBAMAIS]');
        $('#inserirFotosCorpo').append(opt);

        $('#div_aba_fotos span').each(
          function(i, item)
          {
            var srct = '[FOTO' + (i+1) + ']';
            var opt = new Option('Foto ' + (i+1), srct);
            $('#inserirFotosCorpo').append(opt);
          }
        );
        $('#div_aba_videos span').each(
          function(i, item)
          {
            var srct = '[VIDEO' + (i+1) + ']';
            var opt = new Option('Video ' + (i+1), srct);
            $('#inserirFotosCorpo').append(opt);
          }
        );

    }
    function editNameFotos()
    {
        $('#div_aba_fotos span').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
            })
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })

            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
            })
            $(this).find('label:first').text('Foto '+ nitem).wrap('<b' +'/'+'>');
          }
        );
        editComboImg();
    }
    function editNameFotosIPad()
    {
        $('#div_aba_fotosipad span').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem) );
            })

            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + nitem));
            })
            $(this).find('label:first').text('Foto '+ nitem).wrap('<b' +'/'+'>');
          }
        );
    }
    function addDivPhoto()
    {
        var nft = $('#div_aba_fotos span').length;
        $('#div_aba_fotos span:last-child').clone().each(
          function()
          {
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.getAttribute('jtext'))
                    this.setAttribute('jtext', '');
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
            });
            $(this).find('input:last').map(function(i, item){
                $(item).attr('jtext', "");
            });
          }
        ).appendTo('#div_aba_fotos');
        $('#div_aba_fotos span:last-child label:first').text('Foto '+ (nft+1)).wrap('<b'+'><'+'/b>');
        editComboImg();
    }
    function addDivPhotoIPad()
    {
        var nft = $('#div_aba_fotosipad span').length;
        $('#div_aba_fotosipad span:last-child').clone().each(
          function()
          {
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.getAttribute('jtext'))
                    this.setAttribute('jtext', '');
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                if (this.name.search('alinhamento') < 0)
                    this.value = '';
                if (this.getAttribute('temp_folder')) this.setAttribute('temp_folder', '0');
                if (this.getAttribute('old_name')) this.setAttribute('old_name', this.getAttribute('old_name').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('name_input')) this.setAttribute('name_input', this.getAttribute('name_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
                if (this.getAttribute('id_preview')) this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)) );
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
            $(this).find('table:first').map(function(){
                this.setAttribute('id_preview', this.getAttribute('id_preview').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
                this.setAttribute('id_input', this.getAttribute('id_input').replace(/([a-z]*)[0-9]*/, '$1' + (nft+1)));
            });
            $(this).find('input:last').map(function(i, item){
                $(item).attr('jtext', "");
            });
          }
        ).appendTo('#div_aba_fotosipad');
        $('#div_aba_fotosipad span:last-child label:first').text('Foto '+ (nft+1)).wrap('<b'+'><'+'/b>');
    }
    function delDivPhoto(obj)
    {
        var nft = $('#div_aba_fotos span').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_fotos'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('input').map(
             function()
             {
                 if (this.type == 'text' || this.type == 'hidden') this.value = '';
                 if (this.getAttribute('jtext'))
                     this.setAttribute('jtext', '');
             }
            )
        }
        editNameFotos();
    }
    function delDivPhotoIPad(obj)
    {
        var nft = $('#div_aba_fotosipad span').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_fotosipad'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('input').map(
             function()
             {
                 if (this.type == 'text' || this.type == 'hidden') this.value = '';
                 if (this.getAttribute('jtext'))
                     this.setAttribute('jtext', '');
             }
            )
        }
        editNameFotosIPad();
    }
    function editNameVideos()
    {
        $('#div_aba_videos span').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
          }
        );
        editComboImg();
    }
    function editNameVideosIPad()
    {
        $('#div_aba_videosipad span').each(
          function(nitem, item)
          {
            nitem ++;
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + nitem);
            })
            $(this).find('label:first').text('Video '+ nitem).wrap('<b' +'/'+'>');
          }
        );
    }

    function addDivVideo()
    {
        var nft = $('#div_aba_videos span').length;
        $('#div_aba_videos span:last-child').clone().each(
          function()
          {
            $(this).find('textarea').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.value = '';
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
          }
        ).appendTo('#div_aba_videos');
        $('#div_aba_videos span:last-child label:first').text('Video '+ (nft+1)).wrap('<b'+'><'+'/b>');
        editComboImg();
    }
    function addDivVideoIPad()
    {
        var nft = $('#div_aba_videosipad span').length;
        $('#div_aba_videosipad span:last-child').clone().each(
          function()
          {
            $(this).find('input').map(function(){
                this.name = this.name.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.value = '';
            });
            $(this).find('td[id]').map(function(){
                this.id = this.id.replace(/([a-z]*)[0-9]*/, '$1' + (nft+1));
                this.innerHTML = '';
            });
          }
        ).appendTo('#div_aba_videosipad');
        $('#div_aba_videosipad span:last-child label:first').text('Video '+ (nft+1)).wrap('<b'+'><'+'/b>');
    }
    function delDivVideo(obj)
    {
        var nft = $('#div_aba_videos span').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_videos'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('textarea').map( function() { this.value = ''; } )
        }
        editNameVideos();
    }
    function delDivVideoIPad(obj)
    {
        var nft = $('#div_aba_videosipad span').length;
        ocultarDivs(); // divs.js
        var span = obj.parentNode.parentNode; // objeto do span atual
        var divAba = document.getElementById('div_aba_videosipad'); // objeto da div_aba_fotos contendo todos os spans de todas as fotos no HTML
        if (nft > 1)
        {
            divAba.removeChild(span); // remove o span da foto atual, deixando apenas uma (obrigatoria)
        } else {
            $(divAba).find('textarea').map( function() { this.value = ''; } )
        }
        editNameVideosIPad();
    }
    function viewTipoLink(obj)
    {
        while (obj.tagName.toLowerCase() != 'tr')
            obj = obj.parentNode;
        var input = obj.getElementsByTagName('input')[0];

        showTipoLink(input.getAttribute('id'), function(id_campo, jtext, titulo){
            var input = document.getElementById(id_campo);
            input.value = titulo;
            input.setAttribute('jtext', jtext);
        });
    }
    function mudarCapa(checado)
    {
        if (checado)
        {
            $("#divCapa").show()
        }
        else
        {
            $("#divCapa").hide()
        }
    }
    </script>

</slot_script>

<slot_titulo metal:fill-slot="titulo">Adicionar Impresso</slot_titulo>

<slot_ajuda metal:fill-slot="ajuda">
  Cadastrar not&iacute;cia:<br/>
  <li>Utilize a aba de "Fotos" para inserir as fotos da not&iacute;cia. Para utiliz&aacute;-las dentro da not&iacute;cia, volte para a aba "Geral" e selecione uma foto no local da not&iacute;cia que voc&ecirc; quer que a mesma apare&ccedil;a.</li>
  <li>Use o modo editor para alterar o layout da not&iacute;cia.</li>
  <li>Caso n&otilde;o exista um autor/jornalista respons&aacute;vel pela not&iacute;cia, cadastre um no item "Autores" no menu da esquerda.</li>
  <li>O Relacionamento pode enriquecer mais o conte&uacute;do da not&iacute;cia. vincule &agrave; not&iacute;cia um v&iacute;deo, audio ou outra not&iacute;cia.</li>
  <li>Os campos da aba 'Destaque' podem ser utilizados por alguma listagem ou uma pequena exibi&ccedil;&atilde;o deste conte&uacute;do.</li>
  <tal:block tal:condition="python:configuracao.get('titulo_destaque', None) or configuracao.get('descricao_destaque', None) or configuracao.get('ima
gem_destaque', None)">
  <li>Pela configura&ccedil;&atilde;o desta folder, os campos da aba 'Destaque' s&atilde;o obrigat&oacute;rios.</li>
  </tal:block>
  <tal:block tal:condition="python:not configuracao.get('titulo_destaque', None) and not configuracao.get('descricao_destaque', None) and not configuracao.get('imagem_destaque', None)">
  <li>Pela configura&ccedil;&atilde;o desta folder, os campos da aba 'Destaque' n&atilde;o s&atilde;o obrigat&oacute;rios.</li>
  </tal:block>
</slot_ajuda>

<slot_content metal:fill-slot="content">

  <tal:block tal:define="macro python:here.macros('/app/macroiframe.env');">
    <tal:block metal:use-macro="macro/macros/edicao" />
  </tal:block>

  <div class="abas"> 
    <a id="a_aba_geral" href="javascript:mudarAba('geral');ocultarDivs();" class="tab3">Geral</a> |
    <a id="a_aba_fotos" href="javascript:mudarAba('fotos');ocultarDivs();" class="tab2">Fotos</a> |
<!--    <a id="a_aba_videos" href="javascript:mudarAba('videos');ocultarDivs();" class="tab2">V&iacute;deos</a> |-->
    <a id="a_aba_fotosipad" href="javascript:mudarAba('fotosipad');ocultarDivs();" class="tab2">Fotos(iPad)</a> |
    <a id="a_aba_videosipad" href="javascript:mudarAba('videosipad');ocultarDivs();" class="tab2">&Aacute;udios/V&iacute;deos(iPad)</a> |
<!--    <a id="a_aba_destaque" href="javascript:mudarAba('destaque');ocultarDivs();" class="tab2">Destaque</a> |-->
    <a id="a_aba_tags" href="javascript:mudarAba('tags');ocultarDivs();" class="tab2">Tags</a> |
    <a id="a_aba_relacionamento" href="javascript:mudarAba('relacionamento');ocultarDivs();" class="tab2">Relacionamento</a> 
<!--    <a id="a_aba_permissao" href="javascript:mudarAba('permissao');ocultarDivs();" class="tab2">Permiss&atilde;o</a>-->
  </div>

  <div style="height: 40px;" class="ui-dialog-content ui-widget-content" id="box_autor">
    <fieldset>
      <div>
        <div class="formu">
          <label for="titulo">Nome:</label>
          <input type="text" class="" name="autor_titulo" id="autor_titulo" />
        </div>
        <div class="formu">
          <label for="titulo">E-mail:</label>
          <input type="text" class="" name="autor_email" id="autor_email" />
        </div>
        <div class="formu">
          <label for="titulo">Grupo:</label>
          <input type="text" class="" name="autor_grupo" id="autor_grupo" />
        </div><br/><br/>
      </div>
      <img src="/imgs/wait.gif" alt="" id="box_autor_wait" style="display:none" />
    </fieldset>
  </div>

  <form name="conteudo" method="post" enctype="multipart/form-data">
    <fieldset>
      <legend>Nova Not&iacute;cia</legend>
      <div id="div_aba_geral">
        <div class="formu">
          <label for="titulo">T&iacute;tulo: categoria</label>
          <input type="text" class="full" name="titulo_categoria" />
        </div>
        <div class="formu">
          <label for="titulo">T&iacute;tulo:&nbsp;(<span id="count_titulo">0</span>)</label>
          <input tal:attributes="maxlength python: util.test( configuracao.get('titulo_max', ''), configuracao.get('titulo_max', ''), '')" type="text" class="full" name="titulo" onkeyup="document.getElementById('count_titulo').innerHTML = this.value.length;"/>
        </div>
        <div class="formu">
          <label for="resumo">Resumo:&nbsp;(<span id="count_resumo">0</span>)</label>
          <textarea name="descricao" class="full" rows="3" onkeyup="document.getElementById('count_resumo').innerHTML = this.value.length;"></textarea>
        </div>

        <div class="formu">
          <label for="resumo">Tipo:</label>
          <select name="tipo" class="full">
          <option value="">Selecione</option>
          <none tal:repeat="item python:instance._getTipo()" tal:omit-tag="">
          <option tal:attributes="value item/id_tipo_noticia; selected python:util.test(item['id_tipo_noticia'] == 6, 'selected', '')" tal:content="item/titulo"></option>
          </none>
          </select>
        </div><br/><br/><br/>

        <span id="box_autores" tal:define="autores python:[i for i in instance._listarAutores()]">
        <div class="formu">
          <label for="autor">Autor:</label>
          <textarea class="full" name="autor" id="autor" rows="2"></textarea>
        </div>
        </span><br/><br/>

        <div class="formu" nowrap="nowrap">
          <label>Corpo:</label>
          <label><input type="radio" id="tipo_corpo_N" name="tipo_corpo" value="1" onclick="showNormalEditor()" checked="checked" /> Normal</label>
          <label><input type="radio" id="tipo_corpo_E" name="tipo_corpo" value="0" onclick="showFullEditor()" /> Editor</label>
          <label style="width: 75px;">
            <select name="inserirFotosCorpo" id="inserirFotosCorpo" onchange="javascript:insertPicsBody(this);" style="width:95px;">
            <option value="">Marcadores</option>
            <option value="[SAIBAMAIS]">Veja Mais</option>
            <option value="[FOTO1]">Foto 1</option>
            <option value="[VIDEO1]">Video 1</option>
            </select>
          </label>
        </div>
        <div class="formu" nowrap="nowrap">
          <div class="fulleditor" style="display:none" id="fulleditor">
            <textarea mce_editable="true" id="editor_full" name="editor_full" style="width: 100%; height: 450px;"></textarea>
          </div>
        </div>
        <div class="formu" id="normaleditor">
          <textarea id="editor_normal" name="editor_normal" class="full" style="width: 100%; height: 400px;"></textarea>
        </div>
        <div class="formu" style="display:none" nowrap>
          <label>Possui:</label>
          <table>
          <tr>
            <td><input type="checkbox" id="has_video" name="has_video" value="1" /></td>
            <td><label for="has_video">V&iacute;deo</label></td>
            <td><input type="checkbox" id="has_audio" name="has_audio" value="1" /></td>
            <td><label for="has_audio">&Aacute;udio</label></td>
            <td><input type="checkbox" id="has_galeria" name="has_galeria" value="1" /></td>
            <td><label for="has_galeria">Galeria</label></td>
          </tr>
          </table>
        </div>
        <div class="formu">
          <label>Ordem:</label>
          <input type="text" name="ordem" filter="0-9" id="ordem" />
        </div>
        <div class="formu">
          <label>Nome do arquivo (PDF):</label>
          <input type="text" name="pdf" id="pdf" maxlength="12" class="full" />
        </div>
        <div class="formu">
          <label>Not&iacute;cia da capa?</label>
          <input type="checkbox" name="capa" value="" id="capa" onclick="javascript:mudarCapa(this.checked)"/>
        </div>
        <div class="formu" id="divCapa" style="display:none" >
          <label>T&iacute;tulo na capa:</label>
          <input type="text" name="titulo_capa" value="" id="titulo_capa" class="full" />
        </div>
        <div class="formu">&nbsp;</div>
        <div class="formu">&nbsp;</div>
        <div class="formu">
          <label for="campoPublicado">Publicado em:</label>
          <input type="text" name="publicado_em" format="##/##/#### ##:##" filter="0-9" tal:attributes="value python:lastdate or portal._getDateTime()"/>
        </div>
        <div class="formu">
          <label for="campoExpira">Expira em:</label>
          <input type="text" name="expira_em" format="##/##/#### ##:##" filter="0-9" />
        </div>
        <div class="formu">
          <label for="campoExpira">Data edi&ccedil;&atilde;o:</label>
          <input type="text" name="data_edicao" format="##/##/####" filter="0-9" />
        </div>
        <div class="formu" nowrap>
          <label><input type="radio" name="publicado" value="P" checked />&nbsp;Publicado</label>
          <label><input type="radio" name="publicado" value="R" />&nbsp;Rascunho</label>
        </div>

        <div class="formu">&nbsp;</div>
      </div>

      <div id="div_aba_fotos" style="display:none;">
        <input type="hidden" name="contadorFotos" id="contadorFotos" value="1" />

        <span>
          <div class="formu">
            <label class="full"><b>Foto 1</b></label>
          </div>
          <div class="formu" style="display:none">
            <label>Imagem:</label>

            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemsrc1;
                                   global value_input string:;
                                   global name_input string:imagem1;
                                   global value string:;
                                   global temp_folder string:1;
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimg1;
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">

              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu">
            <label>Alinhamento:</label>
            <table>
            <tr>
              <td><input type="radio" name="alinhamento1" value="left" checked="checked" />Esquerda</td>
              <td><input type="radio" name="alinhamento1" value="center" /> Centralizado</td>
              <td><input type="radio" name="alinhamento1" value="right" /> Direita</td>
            </tr>
            </table>
          </div>
          <div class="formu">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="credito1" class="full" class="full" ></textarea>
          </div>
          <div class="formu">
            <label for="campoLegenda1">Legenda da Foto:</label>
            <textarea name="legenda1" class="full"></textarea>
          </div>
          <div class="formu">
            <label for="campoLegenda1">Link:</label>
            <table style="width:70%">
            <tr>
              <td><input type="text" style="width:90%" name="linkfoto1" id="linkfoto1" disabled="disabled" jtext=""/></td>
              <td><a href="javascript:void(0)" onclick="viewTipoLink(this)"><img src="/imgs/ico_tipo_link.gif" /></a></td>
            </tr>
            </table>
          </div>
          <div class="formu">
            <label>Imagem Grande:</label>
            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemgrandesrc1;
                                   global value_input string:;
                                   global name_input string:imagemgrande1;
                                   global value string:;
                                   global temp_folder string:1;
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimggrande1;
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">
              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu" style="text-align:right">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivPhoto()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivPhoto(this)" />
          </div>
        </span>

      </div>

      <div id="div_aba_videos" style="display:none;">
        <input type="hidden" name="contadorVideos" id="contadorVideos" value="1" />
        <span>
          <div class="formu">
            <label class="full"><b>V&iacute;deo 1</b></label>
          </div>
          <div class="formu">
            <label>Embed:</label>
            <textarea style="height:150px" name="embed1" class="full" class="full" ></textarea>
          </div>
          <div class="formu" style="text-align:right">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivVideo()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivVideo(this)" />
          </div>
        </span>
      </div>

      <div id="div_aba_relacionamento" style="display:none">
        <tal:block tal:define="macro python:here.macros('/api/relacionamento.env');">
              <tal:block metal:use-macro="macro/macros/relacionamento"/>
        </tal:block>
      </div>

      <div id="div_aba_destaque" style="display:none">
        <tal:block tal:define="macro python:here.macros('/api/destaque.env');">
              <tal:block metal:use-macro="macro/macros/destaque_add"/>
        </tal:block>
      </div>

      <div class="formu" id="div_aba_tags" style="display:none">
        <div class="formu">
          <label>Tags</label>
          <textarea class="full" name="tags" id="tags" style="height:250px"></textarea>
       </div>
      </div>
      <div class="formu" id="div_aba_fotosipad" style="display:none">
        <input type="hidden" name="contadorFotos" id="contadorFotos" value="1" />
        <div class="formu">
          <label>T&iacute;tulo da galeria:</label>
          <input type="text" name="titulo_galeria" value="" id="titulo_galeria" class="full" />
        </div>
        <span>
          <div class="formu">
            <label class="full"><b>Foto 1</b></label>
          </div>
          <div class="formu">
            <label>Imagem:</label>

            <tal:block tal:define="macro python:here.macros('/app/macroimagem.env');
                                   global name string:imagemipadsrc1;
                                   global value_input string:;
                                   global name_input string:imagemipad1;
                                   global value string:;
                                   global temp_folder string:1;
                                   global typefile string:img;
                                   global isimage string:isimage;
                                   global id_preview string:tempimgipad1;
                                   global sobrescrever string:sobrescrever;
                                   global decompress string:False;
                                   global thumbnail string:;
                                   global dados python:None;
                                   global desctext string:;
                                   global path string:">

              <tal:block metal:use-macro="macro/macros/edicao"/>
            </tal:block>
          </div>
          <div class="formu">
            <label for="campoCredito1">Cr&eacute;dito da Foto:</label>
            <textarea name="creditoipad1" class="full" class="full" ></textarea>
          </div>
          <div class="formu">
            <label for="campoLegenda1">Legenda da Foto:</label>
            <textarea name="legendaipad1" class="full"></textarea>
          </div>
          <div class="formu" style="text-align:right">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivPhotoIPad()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivPhotoIPad(this)" />
          </div>
        </span>
      </div>
      <div class="formu" id="div_aba_videosipad" style="display:none">
        <input type="hidden" name="contadorVideos" id="contadorVideos" value="1" />
        <span>
          <div class="formu">
            <label class="full"><b>Video 1</b></label>
          </div>
<!--          <div class="formu">-->
<!--            <label>&Aacute;udio?</label>-->
            <input type="checkbox" name="audioipad1" id="" style="display:none"/>
<!--            <label><input type="radio" name="video" checked="true" value="Video" id="" />&nbsp; V&iacute;deo</label>-->
<!--            <label><input type="radio" name="video" value="Audio" id="" />&nbsp; &Aacute;udio</label>-->
<!--          </div>-->
          <div class="formu">
            <label>Nome:</label>
            <input type="text" name="nomeipad1" class="full" value="" id="" />
          </div>
          <div class="formu">
            <label>Link:</label>
            <input type="text" name="linkvidipad1" class="full" value="" id="" />
          </div>
          <div class="formu">
            <label >Thumbnail:</label>
            <input type="textarea" name="thumbnailipad1" class="full" value="" id="" />
          </div>
          <div class="formu" style="text-align:right">
            <img alt="Adicionar" style="cursor:pointer" onclick="addDivVideoIPad()" src="/imgs/plu.gif" />
            <img alt="Excluir" style="cursor:pointer" src="/imgs/minu.gif" onclick="delDivVideoIPad(this)" />
          </div>
        </span>
      </div>

      <tal:block tal:define="macro python:here.macros('/api/conteudo_permissao.env');">
            <tal:block metal:use-macro="macro/macros/add"/>
      </tal:block>

      <div class="formu" id="loadVejamais" style="display:none">
        <label for="campoAudios"><img src="/imgs/wait.gif" width="16" height="16"/></label>
        Aguarde, fazendo o upload do <span id="tipoLoadVeja">v&iacute;deo</span> ...<br/><br/><br/>
      </div>
    </fieldset>

    <div class="bts">
     <input id="bt_salvar" type="button" name="salvar" value="Salvar" class="f5bt ok" onclick="validaForm(false)" />
     <input id="bt_salvarp" type="button" name="salvarp" value="Salvar/Publicar" class="f5bt ok" onclick="validaForm(true)" tal:condition="publicacao/exportar" />
    </div>

  </form>
</slot_content>


</metal_macro>
</tal:block>
